<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Participant Intake Form</title>
    <style>
        body {
            font-family: 'Verdana', Geneva, Tahoma, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            max-width: 600px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"], input[type="date"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="checkbox"], input[type="radio"] {
            margin-right: 10px;
        }
        #otherGenderInput {
            display: none;
            margin-top: 10px;
        }
        .checkbox-group {
            margin-bottom: 15px;
        }
        .checkbox-group label {
            font-weight: normal;
        }
        .question-group {
            margin-bottom: 20px;
        }
        button[type="button"] {
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button[type="button"]:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Participant Intake Form</h1>
    <form id="intakeForm">
        <div class="question-group">
            <label for="prolificBackup">Please enter your prolific ID.:</label>
            <input type="text" id="prolificBackup" name="prolificBackup" required>
        </div>

        <div class="question-group">
            <label for="firstName">First Name Initial:</label>
            <input type="text" id="firstName" name="firstName" required>
        </div>

        <div class="question-group">
            <label for="surname">Surname Initial:</label>
            <input type="text" id="surname" required>
        </div>

        <div class="question-group">
            <label for="birthdate">Birthdate:</label>
            <input type="date" id="birthdate" name="birthdate" required>
        </div>

        <div class="question-group">
            <label for="gender">Gender:</label>
            <select id="gender" name="gender" required onchange="showOtherInput()">
                <option value="">Select your gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="nonbinary">Nonbinary</option>
                <option value="transgender">Transgender</option>
                <option value="other">Other (please specify)</option>
            </select>
            <input type="text" id="otherGenderInput" name="otherGender" placeholder="Please specify">
        </div>

        <div class="question-group">
            <label>Do you use tobacco products?</label>
            <div class="checkbox-group">
                <input type="checkbox" id="cigarettes" name="tobaccoProduct" value="cigarettes">
                <label for="cigarettes">Cigarettes</label>
                <input type="number" id="cigarettesPerDay" name="cigarettesPerDay" placeholder="Cigarettes per day" style="width: 50%;" disabled>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="cigars" name="tobaccoProduct" value="cigars">
                <label for="cigars">Cigars</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="pipe" name="tobaccoProduct" value="pipe">
                <label for="pipe">Pipe Tobacco</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="chewingTobacco" name="tobaccoProduct" value="chewingTobacco">
                <label for="chewingTobacco">Chewing Tobacco, Snus</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="chewingTobacco" name="tobaccoProduct" value="chewingTobacco">
                <label for="chewingTobacco">Vape, Nicotine Replacement</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="formerSmoker" name="tobaccoProduct" value="formerSmoker">
                <label for="formerSmoker">Former Smoker</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="noneTobacco" name="tobaccoProduct" value="none">
                <label for="noneTobacco">None</label>
            </div>
        </div>

        <div class="question-group">
            <label>Do you drink alcohol?</label>
            <div class="checkbox-group">
                <input type="radio" id="alcoholYes" name="alcohol" value="yes">
                <label for="alcoholYes">Yes</label>
            </div>
            <div class="checkbox-group">
                <input type="radio" id="alcoholNo" name="alcohol" value="no">
                <label for="alcoholNo">No</label>
            </div>
            <input type="number" id="alcoholUnits" name="alcoholUnits" placeholder="Units per week" style="width: 100%;" disabled>
            <small>Standard unit of alcohol: 1 unit = 10ml or 8g of pure alcohol (e.g., half a pint of beer, 1 small glass of wine).</small>
        </div>

        <div class="question-group">
            <label>Do you use marijuana?</label>
            <div class="checkbox-group">
                <input type="radio" id="marijuanaDaily" name="marijuana" value="daily">
                <label for="marijuanaDaily">Daily</label>
            </div>
            <div class="checkbox-group">
                <input type="radio" id="marijuanaSixYears" name="marijuana" value="sixYears">
                <label for="marijuanaSixYears">In the past six months</label>
            </div>
            <div class="checkbox-group">
                <input type="radio" id="marijuanaNever" name="marijuana" value="never">
                <label for="marijuanaNever">Over six months ago</label>
            </div>
            <div class="checkbox-group">
                <input type="radio" id="marijuanaNever" name="marijuana" value="never">
                <label for="marijuanaNever">Never</label>
            </div>
        </div>

        <div class="question-group">
            <label>Do you currently take any of the following medications?</label>
            <div class="checkbox-group">
                <input type="checkbox" id="antidepressants" name="medications" value="antidepressants">
                <label for="antidepressants">Antidepressants i.e. SSRIs, SNRIs, DNRIs</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="antipsychotics" name="medications" value="antipsychotics">
                <label for="antipsychotics">Antipsychotics/Mood Stabilizers i.e. Lithium, Clozapine, Olanzapine, Risperidone</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="antianxiety" name="medications" value="antianxiety">
                <label for="antianxiety">Anti-anxiety i.e. Benzodiazepines: Alprazolam, Diazepam, Clonazepam</label>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="anticonvulsants" name="medications" value="anticonvulsants">
                <label for="anticonvulsants">Anticonvulsants i.e. Gabapentin, Phenobarbital, Phenytoin, Levetiracetam</label>
            </div>
        </div>

        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <script src="jatos.js"></script>
    <script>
        function showOtherInput() {
            var genderDropdown = document.getElementById("gender");
            var otherGenderInput = document.getElementById("otherGenderInput");

            if (genderDropdown.value === "other") {
                otherGenderInput.style.display = "block";
                otherGenderInput.setAttribute("required", "true");
            } else {
                otherGenderInput.style.display = "none";
                otherGenderInput.removeAttribute("required");
            }
        }

        // Enable/disable additional inputs based on checkbox/radio selections
        document.getElementById('cigarettes').addEventListener('change', function() {
            document.getElementById('cigarettesPerDay').disabled = !this.checked;
        });

        document.getElementsByName('alcohol').forEach(function(radio) {
            radio.addEventListener('change', function() {
                document.getElementById('alcoholUnits').disabled = document.getElementById('alcoholNo').checked;
            });
        });

        function generateParticipantID(name, surname, birthdate, gender) {
            return name.substring(0, 3) + surname.substring(0, 3) + birthdate.replace(/-/g, '') + gender.substring(0, 1);
        }

        function submitForm() {
            const prolificID = getProlificID();  // Get Prolific ID from URL
            const prolificBackup = document.getElementById('prolificBackup').value;
            const firstName = document.getElementById('firstName').value;
            const surname = document.getElementById('surname').value;
            const birthdate = document.getElementById('birthdate').value;
            const gender = document.getElementById('gender').value === 'other' ? document.getElementById('otherGenderInput').value : document.getElementById('gender').value;
            const participantID = generateParticipantID(firstName, surname, birthdate, gender);

            const participantData = {
                prolificID: prolificID, // Add Prolific ID here
                participantID: participantID,
                firstName: firstName,
                surname: surname,
                birthdate: birthdate,
                gender: gender,
                tobaccoProducts: Array.from(document.querySelectorAll('input[name="tobaccoProduct"]:checked')).map(el => el.value),
                cigarettesPerDay: document.getElementById('cigarettesPerDay').value || 0,
                alcohol: document.getElementById('alcoholYes').checked ? 'yes' : 'no',
                alcoholUnits: document.getElementById('alcoholUnits').value || 0,
                marijuana: document.querySelector('input[name="marijuana"]:checked').value,
                medications: Array.from(document.querySelectorAll('input[name="medications"]:checked')).map(el => el.value)
            };

            // Convert participantData to JSON string
            const jsonData = JSON.stringify(participantData);

            jatos.submitResultData(jsonData).then(() => {
                jatos.startNextComponent({ 
                continueSession: true 
                });
            }).catch((error) => {
                console.error("Error submitting data:", error);
            });
        }


        // Function to get the Prolific ID from the URL
        function getProlificID() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('PROLIFIC_PID') || 'UNKNOWN'; // Default to 'UNKNOWN' if no ID is provided
        }


    </script>
</body>
</html>

